<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TWL Roster 2025｜adjustment-lab</title>
<meta name="theme-color" content="#007b9e">
<style>
:root {
  --bg:#f8faf9;
  --text:#1a1a1a;
  --accent:#007b9e;
  --card:#fff;
  --line:rgba(0,0,0,0.08);
  font-family:'Noto Sans JP',sans-serif;
}
body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  line-height:1.8;
  -webkit-font-smoothing:antialiased;
}
header {
  background:var(--accent);
  color:#fff;
  text-align:center;
  padding:16px;
}
h1 { margin:0; font-size:20px; }
section {
  padding:20px;
  max-width:1000px;
  margin:auto;
}
h2 {
  border-left:4px solid var(--accent);
  padding-left:8px;
  margin-top:40px;
}
.roster {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.card {
  background:var(--card);
  border:1px solid var(--line);
  border-radius:8px;
  padding:10px;
  width:calc(33.333% - 10px);
  cursor:pointer;
  box-shadow:0 1px 3px rgba(0,0,0,0.05);
  transition:transform 0.15s ease;
}
.card:hover { transform:scale(1.03); }
.card h3 {
  margin:0;
  font-size:16px;
  color:var(--accent);
}
.card p { margin:2px 0; font-size:13px; color:#333; }
@media(max-width:700px){ .card{width:calc(50% - 10px);} }
@media(max-width:480px){ .card{width:100%;} }
.modal {
display:none;
position:fixed;
top:0; left:0;
width:100%; height:100%;
background:rgba(0,0,0,0.5);
justify-content:center;
align-items:center;
}
.modal-content {
background:#fff;
border-radius:10px;
padding:20px;
width:90%;
max-width:400px;
}
.modal-content h3 { color:var(--accent); margin-top:0; }
.close {
float:right;
cursor:pointer;
color:#999;
}
footer {
text-align:center;
font-size:13px;
color:#666;
padding:40px 0 60px;
}
</style>
</head>
<body>
<header><h1>TWL Roster 2025｜adjustment-lab</h1></header>
<section id="pitchers"><h2>投手</h2><div class="roster"></div></section>
<section id="catchers"><h2>捕手</h2><div class="roster"></div></section>
<section id="infielders"><h2>内野手</h2><div class="roster"></div></section>
<section id="outfielders"><h2>外野手</h2><div class="roster"></div></section>
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close">✕</span>
    <h3 id="modal-name"></h3>
    <p id="modal-team"></p>
    <p id="modal-info"></p>
    <p id="modal-school"></p>
    <canvas id="radarChart" width="300" height="300"></canvas>
    <hr>
    <h4>評価入力</h4>
    <label>10m（s）<input id="s10" type="number" step="0.01"></label><br>
    <label>30m（s）<input id="s30" type="number" step="0.01"></label><br>
    <label>CMJ（cm）<input id="cmj" type="number"></label><br>
    <label>RSI<input id="rsi" type="number" step="0.01"></label><br>
    <button id="calcBtn">評価を算出</button>
    <div id="evalResult"></div>
  </div>
</div>

<footer>© 2025 adjustment-lab</footer>

<script src="./logic-eval.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
fetch("./assets/players.json")
  .then(res => res.json())
  .then(players => {
    const groups = {
      "投手": document.querySelector("#pitchers .roster"),
      "捕手": document.querySelector("#catchers .roster"),
      "内野手": document.querySelector("#infielders .roster"),
      "外野手": document.querySelector("#outfielders .roster")
    };
    players.forEach(p => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `<h3>${p.name}</h3><p>${p.team}</p><p>${p.age}歳／${p.height}cm ${p.weight}kg</p>`;
      div.addEventListener("click", () => showModal(p));
      if (groups[p.position]) groups[p.position].appendChild(div);
    });
  })
  .catch(err => console.error("JSON読み込みエラー:", err));

const modal = document.getElementById("modal");
const closeBtn = document.querySelector(".close");
const evalResult = document.getElementById("evalResult");
let radarChartInstance = null;

function showModal(p) {
  document.getElementById("modal-name").textContent = p.name + "（" + p.kana + "）";
  document.getElementById("modal-team").textContent = `${p.team}｜${p.position}`;
  document.getElementById("modal-info").textContent = `${p.age}歳／${p.throws}投${p.bats}打／${p.height}cm ${p.weight}kg`;
  document.getElementById("modal-school").textContent = `${p.highschool}${p.university ? " → " + p.university : ""}`;
  modal.style.display = "flex";
  evalResult.textContent = "";
}

closeBtn.onclick = () => (modal.style.display = "none");
window.onclick = e => { if (e.target === modal) modal.style.display = "none"; };

document.getElementById("calcBtn").onclick = () => {
  const s10 = parseFloat(document.getElementById("s10").value);
  const s30 = parseFloat(document.getElementById("s30").value);
  const cmj = parseFloat(document.getElementById("cmj").value);
  const rsi = parseFloat(document.getElementById("rsi").value);

  const result = calcTotalScore({ s10, s30, cmj, rsi });
  const vo2 = 50; // 仮値
  const profile = getProfileType(vo2, result.totalBatter);

  evalResult.innerHTML = `
    <p>総合スコア：${result.totalBatter.toFixed(1)}</p>
    <p style="color:${profile.color};font-weight:bold;">タイプ：${profile.type}</p>
    <p>${profile.desc}</p>
  `;

  const ctx = document.getElementById('radarChart');
  if (!ctx) return;
  if (radarChartInstance) radarChartInstance.destroy();

  radarChartInstance = new Chart(ctx, {
    type: 'radar',
    data: {
      labels: ['Sprint', 'CMJ', 'RSI', 'Agility', 'Blast', 'Rapsodo'],
      datasets: [{
        label: profile.type,
        data: [
          result.sprintScore,
          result.cmjScore,
          result.rsiScore,
          result.agilityScore,
          result.blastScore,
          result.rapsodoBatterScore
        ],
        backgroundColor: `${profile.color}40`,
        borderColor: profile.color,
        borderWidth: 2,
        pointBackgroundColor: profile.color
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 6,
          ticks: { stepSize: 1, display: false },
          grid: { color: 'rgba(0,0,0,0.1)' },
          angleLines: { color: 'rgba(0,0,0,0.1)' },
          pointLabels: { color: '#333', font: { size: 12 } }
        }
      },
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: `${profile.type}｜${profile.desc}`,
          color: '#333',
          font: { size: 14 }
        }
      }
    }
  });
};
</script>
</body>
</html>
